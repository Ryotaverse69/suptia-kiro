# Suptia Git Workflow 受け入れテスト仕様

## 概要

このドキュメントは、Suptia Git Workflow の受け入れテスト仕様を定義します。全ての要件が正しく実装され、期待通りに動作することを確認するための包括的なテストスイートです。

## テスト実行方法

### 基本実行

```bash
# 受け入れテスト実行
npm run acceptance:run

# テストのみ実行（環境準備なし）
npm run acceptance:test

# レポート生成
node scripts/generate-acceptance-report.mjs
```

### 前提条件

- Node.js 18以上がインストールされていること
- npm または pnpm がインストールされていること
- Git リポジトリが初期化されていること
- 必要な依存関係がインストールされていること

## テスト項目

### Requirement 1: ブランチ構成の確立

| テストID | テスト名                    | 検証内容                                | 期待結果                                     |
| -------- | --------------------------- | --------------------------------------- | -------------------------------------------- |
| 1.1      | master/dev ブランチ存在確認 | master と dev ブランチが存在する        | 両ブランチが存在すること                     |
| 1.2      | デフォルトブランチ確認      | デフォルトブランチが master/main である | デフォルトブランチが正しく設定されていること |

### Requirement 2: 開発フローの自動化

| テストID | テスト名                        | 検証内容                                                    | 期待結果                                 |
| -------- | ------------------------------- | ----------------------------------------------------------- | ---------------------------------------- |
| 2.1      | GitHub Actions ワークフロー確認 | CI ワークフローファイルが存在し、必須ジョブが定義されている | 全ての必須ジョブが設定されていること     |
| 2.2      | npm スクリプト確認              | package.json に必須スクリプトが定義されている               | 全ての必須スクリプトが実行可能であること |

### Requirement 3: ブランチ保護とセキュリティ

| テストID | テスト名             | 検証内容                                         | 期待結果                                   |
| -------- | -------------------- | ------------------------------------------------ | ------------------------------------------ |
| 3.1      | ブランチ保護設定確認 | ブランチ保護に必要なワークフローが設定されている | 必要なワークフローファイルが存在すること   |
| 3.2      | セキュリティ設定確認 | セキュリティ関連ファイルが存在する               | セキュリティ設定が適切に構成されていること |

### Requirement 4: CI/CD パイプラインの実装

| テストID | テスト名            | 検証内容                               | 期待結果                                 |
| -------- | ------------------- | -------------------------------------- | ---------------------------------------- |
| 4.1      | format チェック実行 | コードフォーマットチェックが実行される | フォーマットチェックが正常に完了すること |
| 4.2      | lint チェック実行   | ESLint チェックが実行される            | Lint チェックが正常に完了すること        |
| 4.3      | テスト実行          | 単体テストが実行される                 | 全てのテストが成功すること               |
| 4.4      | typecheck 実行      | TypeScript 型チェックが実行される      | 型チェックが正常に完了すること           |
| 4.5      | build チェック実行  | ビルドプロセスが実行される             | ビルドが正常に完了すること               |

### Requirement 5: Vercel 連携とデプロイ自動化

| テストID | テスト名         | 検証内容                           | 期待結果                             |
| -------- | ---------------- | ---------------------------------- | ------------------------------------ |
| 5.1      | Vercel 設定確認  | vercel.json が正しく設定されている | 必要な設定項目が全て含まれていること |
| 5.2      | 環境変数設定確認 | 環境変数の設定例が提供されている   | 必須環境変数が定義されていること     |

### Requirement 6: ブランチクリーンアップの自動化

| テストID | テスト名                       | 検証内容                                 | 期待結果                               |
| -------- | ------------------------------ | ---------------------------------------- | -------------------------------------- |
| 6.1      | ブランチクリーンアップ設定確認 | 自動クリーンアップの設定が構成されている | クリーンアップ関連の設定が存在すること |

### Requirement 7: 開発者体験の最適化

| テストID | テスト名              | 検証内容                          | 期待結果                         |
| -------- | --------------------- | --------------------------------- | -------------------------------- |
| 7.1      | 開発フロー文書確認    | 開発フロー文書が存在する          | 必要な文書が提供されていること   |
| 7.2      | pre-commit フック確認 | pre-commit フックが設定されている | フックが正しく設定されていること |

### Requirement 8: 監視と品質保証

| テストID | テスト名               | 検証内容                           | 期待結果                             |
| -------- | ---------------------- | ---------------------------------- | ------------------------------------ |
| 8.1      | メトリクス収集確認     | メトリクス収集スクリプトが存在する | 必要なスクリプトが提供されていること |
| 8.2      | 品質チェックツール確認 | 品質チェックツールが設定されている | 必要なツールが利用可能であること     |

### エンドツーエンドテスト

| テストID | テスト名                   | 検証内容                             | 期待結果                               |
| -------- | -------------------------- | ------------------------------------ | -------------------------------------- |
| E2E-1    | 開発フロー統合テスト       | 完全な開発フローが機能する           | 全ての基本機能が統合されて動作すること |
| E2E-2    | CI/CD パイプライン模擬実行 | CI/CD パイプラインが正常に実行される | 全ての CI/CD ステップが成功すること    |

## 成功基準

### 必須条件（全て満たす必要がある）

1. **全ての要件テストが成功する**
   - Requirement 1-8 の全てのテストが PASSED 状態である

2. **エンドツーエンドテストが成功する**
   - E2E-1, E2E-2 の両方が PASSED 状態である

3. **重要なファイルが存在する**
   - `.github/workflows/ci.yml`
   - `vercel.json`
   - `package.json` (必須スクリプト含む)
   - 開発フロー文書

4. **基本的な CI/CD パイプラインが動作する**
   - format, lint, test, typecheck, build が全て成功する

### 推奨条件（可能な限り満たすことが望ましい）

1. **セキュリティ設定が完備されている**
   - セキュリティ関連ファイルとスクリプトが存在する

2. **監視・メトリクス機能が利用可能である**
   - メトリクス収集と分析スクリプトが動作する

3. **開発者体験が最適化されている**
   - pre-commit フックが設定されている
   - 包括的な文書が提供されている

## 失敗時の対応

### 一般的な問題と解決方法

1. **依存関係の問題**

   ```bash
   # 依存関係を再インストール
   rm -rf node_modules package-lock.json
   npm install
   ```

2. **環境変数の問題**

   ```bash
   # 環境変数設定例をコピー
   cp apps/web/.env.local.example apps/web/.env.local
   # 必要な値を設定
   ```

3. **Git リポジトリの問題**

   ```bash
   # Git 状態確認
   git status
   # 未コミットの変更をコミット
   git add .
   git commit -m "Fix issues for acceptance test"
   ```

4. **ビルドエラー**
   ```bash
   # TypeScript エラー確認
   npm run typecheck
   # Lint エラー修正
   npm run lint:fix
   # フォーマット修正
   npm run format
   ```

## レポート出力

### JSON レポート

- ファイル: `acceptance-test-report.json`
- 内容: 詳細なテスト結果データ

### Markdown レポート

- ファイル: `acceptance-test-report.md`
- 内容: 人間が読みやすい形式のレポート

### コンソール出力

- リアルタイムでテスト進行状況を表示
- 成功/失敗の即座のフィードバック
- エラー詳細の表示

## 継続的な改善

### 定期実行の推奨

1. **開発環境での実行**
   - 新機能開発前
   - 大きな変更後
   - 定期的なヘルスチェック

2. **CI/CD での実行**
   - PR 作成時
   - master ブランチマージ前
   - リリース前

### メトリクス追跡

- テスト実行時間の監視
- 成功率の追跡
- 失敗パターンの分析

### テスト項目の拡張

- 新要件追加時のテスト項目追加
- パフォーマンステストの統合
- セキュリティテストの強化

---

_このドキュメントは受け入れテストの実行と結果解釈のためのガイドです。テスト項目や基準は要件の変更に応じて更新される場合があります。_
