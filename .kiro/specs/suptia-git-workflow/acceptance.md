# Acceptance Criteria

## Overview

Suptia Git Workflow の実装完了を判定するための受け入れ基準。各機能が要件通りに動作し、開発者が効率的で安全な開発フローを実行できることを確認する。

## 1. ブランチ構成の受け入れ基準

### AC-1.1: ブランチ構成確認
- [ ] `git branch -a` で master と dev ブランチが存在する
- [ ] master がデフォルトブランチに設定されている
- [ ] 不要な常設ブランチが存在しない

### AC-1.2: ブランチ役割確認
- [ ] master ブランチが本番環境専用として機能する
- [ ] dev ブランチが開発環境専用として機能する
- [ ] 各ブランチが適切な Vercel 環境と連携している

## 2. 開発フローの受け入れ基準

### AC-2.1: dev ブランチ直接 push
```bash
# テスト手順
git switch dev
echo "test change" >> test.txt
git add test.txt
git commit -m "test: dev push test"
git push origin dev
```
- [ ] dev ブランチへの直接 push が成功する
- [ ] push 後に Vercel Preview 環境が自動更新される
- [ ] Preview URL が生成される

### AC-2.2: PR 作成と自動マージ
```bash
# テスト手順
# GitHub UI で dev → master の PR を作成
```
- [ ] PR 作成時に必須チェックが自動実行される
- [ ] 全チェック通過後に自動マージされる
- [ ] マージ後に本番環境が自動デプロイされる

### AC-2.3: 本番デプロイ確認
- [ ] master マージ後に Vercel Production 環境が更新される
- [ ] 本番 URL で変更内容が反映される
- [ ] デプロイ完了通知が適切に送信される

## 3. ブランチ保護の受け入れ基準

### AC-3.1: master ブランチ保護
```bash
# テスト手順（失敗することを確認）
git switch master
echo "direct push test" >> test.txt
git add test.txt
git commit -m "test: direct push to master"
git push origin master
```
- [ ] master ブランチへの直接 push が拒否される
- [ ] 適切なエラーメッセージが表示される

### AC-3.2: PR 必須確認
- [ ] master への変更は PR 経由でのみ可能
- [ ] 最低1名の承認が必要
- [ ] 新しいコミット時に古い承認が無効化される

### AC-3.3: リニア履歴確認
- [ ] master ブランチの履歴がリニアに保たれる
- [ ] マージコミットが squash される

## 4. CI/CD パイプラインの受け入れ基準

### AC-4.1: 必須チェック実行
```bash
# テスト手順
git switch dev
# 意図的にエラーを含むコードを追加
git add .
git commit -m "test: CI check test"
git push origin dev
# GitHub UI で dev → master の PR を作成
```
- [ ] format:check が実行される
- [ ] lint が実行される
- [ ] test が実行される
- [ ] typecheck が実行される
- [ ] build が実行される
- [ ] headers が実行される
- [ ] jsonld が実行される
- [ ] pr-dod-check が実行される

### AC-4.2: チェック失敗時の動作
- [ ] いずれかのチェックが失敗した場合、マージが阻止される
- [ ] 失敗理由が明確に表示される
- [ ] 修正後の再実行が可能

### AC-4.3: パフォーマンス要件
- [ ] CI パイプライン全体が15分以内に完了する
- [ ] 並列実行により効率的に処理される
- [ ] タイムアウト設定が適切に機能する

## 5. Vercel 連携の受け入れ基準

### AC-5.1: Preview 環境デプロイ
```bash
# テスト手順
git switch dev
echo "preview test" >> apps/web/src/app/page.tsx
git add .
git commit -m "test: preview deployment"
git push origin dev
```
- [ ] dev push 後に Preview 環境が自動更新される
- [ ] 一意の Preview URL が生成される
- [ ] 変更内容が Preview 環境に反映される

### AC-5.2: 本番環境デプロイ
```bash
# テスト手順
# dev → master の PR を作成・マージ
```
- [ ] master マージ後に本番環境が自動デプロイされる
- [ ] 本番 URL で変更内容が確認できる
- [ ] デプロイ時間が適切な範囲内

### AC-5.3: 環境変数同期
- [ ] Production と Preview で必要な環境変数が設定されている
- [ ] 環境変数の不整合がない
- [ ] 環境変数チェックスクリプトが正常動作する

### AC-5.4: デプロイ失敗時の対応
- [ ] デプロイ失敗時に適切な通知が送信される
- [ ] エラーログが確認できる
- [ ] ロールバック機能が利用可能

## 6. 品質保証の受け入れ基準

### AC-6.1: pre-commit フック
```bash
# テスト手順
git switch dev
# フォーマットエラーを含むコードを追加
git add .
git commit -m "test: pre-commit hook"
```
- [ ] pre-commit フックが実行される
- [ ] フォーマットエラーが自動修正される
- [ ] テストが実行される
- [ ] 環境変数チェックが実行される

### AC-6.2: コード品質維持
- [ ] ESLint ルールが適切に適用される
- [ ] Prettier フォーマットが統一される
- [ ] TypeScript 型チェックが機能する
- [ ] テストカバレッジが維持される

## 7. 開発者体験の受け入れ基準

### AC-7.1: 開発フロー文書
- [ ] 明確で理解しやすい開発フロー文書が存在する
- [ ] 視覚的な図表が含まれている
- [ ] ステップバイステップガイドが提供されている
- [ ] トラブルシューティング情報が含まれている

### AC-7.2: 開発環境切り替え
```bash
# テスト手順
git switch dev
```
- [ ] `git switch dev` のみで開発環境に切り替えられる
- [ ] 追加の設定作業が不要
- [ ] 即座に開発作業を開始できる

### AC-7.3: エラーメッセージ
- [ ] エラー発生時に明確なメッセージが表示される
- [ ] 解決方法が提示される
- [ ] 関連ドキュメントへのリンクが提供される

## 8. 監視と運用の受け入れ基準

### AC-8.1: メトリクス収集
- [ ] CI/CD パイプラインの実行時間が記録される
- [ ] デプロイ成功率が追跡される
- [ ] ビルド失敗の原因が分析可能

### AC-8.2: アラート機能
- [ ] 重要な障害時にアラートが送信される
- [ ] 適切な担当者に通知される
- [ ] エスカレーション機能が動作する

### AC-8.3: ダッシュボード
- [ ] 開発チームが状況を把握できるダッシュボードが存在する
- [ ] リアルタイムでステータスが確認できる
- [ ] 履歴データが参照できる

## 9. セキュリティの受け入れ基準

### AC-9.1: アクセス制御
- [ ] 適切な権限設定がされている
- [ ] 不正なアクセスが防止される
- [ ] 監査ログが記録される

### AC-9.2: シークレット管理
- [ ] 機密情報が適切に保護される
- [ ] 環境変数が暗号化される
- [ ] アクセス権限が制限される

### AC-9.3: 脆弱性対策
- [ ] 依存関係スキャンが実行される
- [ ] セキュリティアラートが通知される
- [ ] 自動更新機能が動作する

## 10. パフォーマンスの受���入れ基準

### AC-10.1: ビルド時間
- [ ] ローカルビルドが5分以内に完了する
- [ ] CI ビルドが10分以内に完了する
- [ ] キャッシュ機能が効果的に動作する

### AC-10.2: デプロイ時間
- [ ] Preview デプロイが3分以内に完了する
- [ ] 本番デプロイが5分以内に完了する
- [ ] ダウンタイムが最小限に抑えられる

### AC-10.3: リソース使用量
- [ ] CI リソース使用量が適切な範囲内
- [ ] 並列実行が効率的に��作する
- [ ] 不要なリソース消費がない

## 11. 統合テストの受け入れ基準

### AC-11.1: エンドツーエンドフロー
```bash
# 完全フローテスト手順
1. git switch dev
2. 機能追加・修正
3. git add . && git commit -m "feat: new feature"
4. git push origin dev
5. Preview 環境で動作確認
6. GitHub UI で PR 作成
7. CI チェック完了確認
8. 自動マージ確認
9. 本番デプロイ確認
```
- [ ] 上記フローが問題なく完了する
- [ ] 各ステップで期待される動作が確認できる
- [ ] エラーが発生しない

### AC-11.2: 障害復旧テスト
- [ ] CI 失敗からの復旧が可能
- [ ] デプロイ失敗からの復旧が可能
- [ ] ロールバック機能が正常動作する

## 12. 受け入れ完了条件

### 最終確認チェックリスト
- [ ] 全ての受け入れ基準が満たされている
- [ ] 開発チーム全員が新しいフローを理解している
- [ ] 文書が最新の状態に更新されている
- [ ] 監視・アラート機能が正常動作している
- [ ] セキュリティ要件が満たされている
- [ ] パフォーマンス要件が満たされている
- [ ] 障害時の対応手順が確立されている

### 運用開始準備
- [ ] 開発チーム向けトレーニングが完了している
- [ ] 運用手順書が整備されている
- [ ] 緊急時連絡体制が確立されている
- [ ] バックアップ・復旧手順が確認されている

## 受け入れテスト実行記録

### テスト実行日: ___________
### テスト実行者: ___________
### 結果: [ ] 合格 / [ ] 不合格

### 不合格項目（該当する場合）:
- 項目: ___________
- 理由: ___________
- 対応予定: ___________

### 承認者サイン: ___________