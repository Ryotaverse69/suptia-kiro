# Acceptance Criteria

**specVersion**: 2025-08-16

## M3: プラットフォーム化 - 受け入れ基準

### 1. ログ復元

**検証項目:**
- [ ] 削除されたログを30日以内であれば完全に復元できる
- [ ] 摂取ログ（商品ID・摂取量・摂取時刻・メモ）の記録が動作する
- [ ] 摂取目標（期間・目標摂取量・アラート設定）の管理が動作する
- [ ] 日次・週次・月次の摂取状況グラフ表示が動作する

**テストケース:**
```
Given: ユーザーが摂取ログを削除する
When: 25日後にログ復元を要求する
Then: 削除されたログが完全に復元される
And: 全てのデータ（商品ID・摂取量・時刻・メモ）が復旧する
And: 復元後のデータ整合性が保たれる

Given: 31日後にログ復元を要求する
When: 復元処理を実行する
Then: 「復元期間を過ぎています」エラーが表示される
```

### 2. 重み変更の説明

**検証項目:**
- [ ] 推奨アルゴリズムの重み変更理由を具体的に説明できる
- [ ] 「なぜこの商品が推奨されるか」の理由が具体的に表示される
- [ ] ユーザーフィードバックに基づく重み再学習が動作する
- [ ] 推奨精度の向上が定量的に測定される

**テストケース:**
```
Given: ユーザーが商品Aに低評価フィードバックを提供する
When: 重み再学習を実行する
Then: 商品Aの推奨重みが下がる
And: 重み変更の理由が「ユーザー評価が低いため」と説明される
And: 変更の影響が「今後の推奨頻度が下がります」と説明される
And: 説明が具体的で理解しやすい
```

### 3. 外部データはオプトイン必須

**検証項目:**
- [ ] 外部データ使用時にユーザーの明示的なオプトイン同意が必須として機能する
- [ ] OAuth 2.0による安全な認証・認可が動作する
- [ ] データ使用目的が明確に説明される
- [ ] ワンクリック連携解除と関連データ削除が動作する

**テストケース:**
```
Given: 健康管理アプリとの連携を設定する
When: 外部データ使用を試行する
Then: 明示的な同意画面が表示される
And: データ使用目的が明確に説明される
And: 同意なしではデータ使用ができない
And: 同意後にのみデータ連携が開始される

Given: 連携を解除する
When: ワンクリック解除を実行する
Then: 連携が即座に解除される
And: 関連する外部データが削除される
```

### 4. コミュニティモデレーション

**検証項目:**
- [ ] 薬機法準拠の自動モデレーション（医療効果・疾患名・治療効果断定表現の検出・削除）が動作する
- [ ] 商品レビュー・摂取体験・質問・回答の投稿機能が動作する
- [ ] 投稿の有用性評価・いいね・フォロー機能が動作する
- [ ] 不適切投稿の報告・削除・ユーザー制限機能が動作する

**テストケース:**
```
Given: 「このサプリで糖尿病が治りました」という投稿を作成する
When: 自動モデレーションを実行する
Then: 医療効果の断定表現として検出される
And: 投稿が自動削除される
And: ユーザーに警告が送信される
And: 薬機法違反表現が0件になる

Given: 適切な摂取体験を投稿する
When: 投稿を公開する
Then: 「個人の体験です」等の免責事項が自動追加される
And: 投稿が正常に公開される
```

## 横断DoD（Definition of Done）

### プラットフォーム機能
- [ ] 摂取履歴・目標・評価・購入履歴を学習データとした推奨生成が動作
- [ ] 健康管理アプリ・購入履歴・活動データの連携が動作
- [ ] 各機能・データ使用に対する個別同意管理が動作
- [ ] 30日以内のユーザーデータ完全削除が動作

### データ管理
- [ ] 収集データ・使用目的・共有先・保存期間の明示が動作
- [ ] JSON形式でのデータエクスポート機能が動作
- [ ] 不正確なデータの修正・更新機能が動作
- [ ] GDPR準拠のプライバシー管理が動作

### 品質保証
- [ ] CI品質チェック（ログ復元・重み変更説明・外部データオプトイン必須・モデレーション）が全て通過
- [ ] A11y強化（ログ入力フォーム・履歴グラフ・投稿フォーム・OAuth画面・推奨説明）が実装済み
- [ ] ドキュメント更新（LEARNING・INTEGRATIONS・COMMUNITY仕様書）が完了
- [ ] パフォーマンス監視（ログ処理・学習処理・コミュニティ・外部連携）が実装済み

### セキュリティ・コンプライアンス
- [ ] 個人健康情報の暗号化保存が実装済み
- [ ] OAuth認証のセキュリティ強化（PKCE対応）が実装済み
- [ ] コンテンツフィルタリングによる不適切投稿防止が動作
- [ ] 監査ログによる不正アクセス検出が動作